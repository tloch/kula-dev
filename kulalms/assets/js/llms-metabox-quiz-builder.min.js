!function(t){window.llms=window.llms||{},t.fn.getQuestionId=function(){var t=this.closest("tr.llms-question");return t.length?t.attr("data-question-id"):0},t.fn.llmsSelect2ify=function(){return this.llmsSelect2({allowClear:!1,ajax:{dataType:"JSON",delay:250,method:"POST",url:window.ajaxurl,data:function(t){return{term:t.term,page:t.page?t.page-1:0,action:"query_quiz_questions",post_id:self.quiz_id}},processResults:function(e,i){return{results:t.map(e.items,function(t){return{text:t.name,id:t.id}}),pagination:{more:e.more}}}},cache:!0,placeholder:"Select a Question",multiple:!1,width:"100%"}),this},window.llms.metabox_quiz_builder=function(){this.quiz_id=null,this.init=function(){this.bind(),this.bind_sortable(),this.set_total_points(),this.quiz_id=t("#post_ID").val()},this.bind=function(){var e=this,i=t("#llms-single-options");i.find(".llms-question select").llmsSelect2ify(),t(".llms-points").blur(function(t){t.preventDefault(),e.set_total_points()}),t("#add_new_question").on("click",function(i){i.preventDefault(),e.add_new_question(t(this))}),i.on("change",".llms-question-select",function(){var e=t(this);e.closest("tr.llms-question").attr("data-question-id",e.val())}),i.on("click",".llms-fa-edit",function(i){i.preventDefault(),window.open(e.get_question_edit_link(t(this).getQuestionId()))}),i.on("click",".llms-remove-question",function(i){t(this).closest("tr.llms-question").remove(),e.set_total_points()}),i.on("keyup",".llms-points",function(){e.set_total_points()}),i.on("select2:selecting","select",function(t){var i=t.params.args.data.id,n=e.get_selected_question_ids();n.indexOf(i)!==-1&&(t.preventDefault(),alert("You cannot select the same question more than once per quiz."))})},this.bind_sortable=function(){t(".question-list").sortable({axis:"y",cursor:"move",forcePlaceholderSize:!0,placeholder:"placeholder",items:".list_item",helper:function(e,i){var n=i.children(),s=i.clone();return s.children().each(function(e){t(this).width(n.eq(e).width())}),s},start:function(t,e){e.item.data("start_pos",e.item.index())}})},this.add_new_question=function(t){var e=this,i=e.get_question_html();i.find("select").llmsSelect2ify(),i.appendTo("#llms-single-options .question-list tbody").hide().fadeIn(300),this.set_total_points()},this.get_question_edit_link=function(t){var e=window.llms.admin_url+"post.php?action=edit&post="+t;return e},this.get_total_points=function(){var e=0;return t("#llms-single-options .llms-points").each(function(){e+=Number(t(this).val())}),e},this.get_total_questions=function(){return t("#llms-single-options tbody tr").length},this.get_question_html=function(){return t(t("#llms-single-question-template").html()).find("tr")},this.get_selected_question_ids=function(){var e=[];return t("#llms-single-options .llms-question").each(function(){var i=t(this).attr("data-question-id");i&&"0"!==i&&e.push(i)}),e},this.set_total_points=function(){t("#llms_points_total").text(this.get_total_points())},this.init()};new window.llms.metabox_quiz_builder}(jQuery);