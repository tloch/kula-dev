function wait(){var e=jQuery.Deferred();return setTimeout(function(){e.resolve()},2500),e.promise()}jQuery(document).ready(function(e){var t={".chosen-select":{},".chosen-select-deselect":{allow_single_deselect:!0},".chosen-select-no-single":{disable_search_threshold:10},".chosen-select-no-results":{no_results_text:"Oops, nothing found!"},".chosen-select-width":{width:"95%"}};for(var s in t)e(s).chosen(t[s]);e("select").each(function(){reverse_selection(this)}),e(".section-select").click(function(){reverse_selection(this)}),e(".section-select").attr("disabled","disbaled"),e(".lesson-select").attr("disabled","disbaled"),e(".section-select").change(function(){}),e(".lesson-select").change(function(){update_syllabus()}),e("#addNewSection").click(function(e){return add_new_section(),!1}),e(".addNewLesson").click(function(e){return add_new_lesson(e),!1}),e(".deleteBtn").click(function(){return delete_this(this),!1}),e(".section-dismiss").click(function(){return delete_this(this),!1}),lessons_sortable(),load_ajax_animation(),sections_sortable(),order_lessons()}),reverse_selection=function(e){jQuery(e).data("last_selected",jQuery(e).val())},catch_blanks=function(){jQuery(".section-select").each(function(){null==jQuery(this).val()||""==jQuery(this).val()?alert("Unable to save. Please make sure all of your sections are assigned."):update_syllabus()})},catch_duplicates=function(e){var t=(jQuery(this),[]),s=jQuery(e).val(),a=jQuery(e).data("last_selected");jQuery(".section-select").each(function(){if(s==jQuery(this).val()&&t.push(jQuery(this).val()),t.length>1)return alert("You cannot select a section already assigned to this course."),jQuery(e).val(a).attr("selected",!0),!1});var n=wait();n.done(update_syllabus);var o=jQuery(e).parent().parent().attr("id");get_associated_lessons(s,o)},lessons_sortable=function(){jQuery(".dad-list").sortable({items:".list_item",axis:"y",placeholder:"placeholder",cursor:"move",forcePlaceholderSize:!0,helper:function(e,t){var s=t.children(),a=t.clone();return a.children().each(function(e){jQuery(this).width(s.eq(e).width())}),a},start:function(e,t){var s=t.item.index();t.item.data("start_pos",s)},update:function(e,t){var s=(t.item.data("start_pos"),jQuery(t.item).index());jQuery(t.item).attr("data-order",s),order_lessons(),update_syllabus()}})},order_lessons=function(){jQuery(".course-section").each(function(e){var t=jQuery(this).attr("id");jQuery(this).find(".list_item").each(function(e){jQuery(this).attr("data-order",e+1),jQuery(this).attr("id","row_"+t+"_"+(e+1))})}),jQuery(".course-section").each(function(e){var t=jQuery(this).attr("id");jQuery(this).find(".lesson-select").each(function(e){jQuery(this).attr("data-order",e+1),jQuery(this).attr("id","list_item_"+t+"_"+(e+1))})}),jQuery(".course-section").each(function(e){console.log(e);var t=jQuery(this).attr("id");jQuery(this).find(".section-select").each(function(e){console.log("-------------------------------"),console.log(t),jQuery(this).attr("id","section_item_"+t)})})},sections_sortable=function(){jQuery("#syllabus").sortable({items:".course-section",axis:"y",placeholder:"sortable-placeholder section-placeholder",cursor:"move",start:function(e,t){var s=t.item.index();t.item.data("start_pos",s)},update:function(e,t){var s=(t.item.data("start_pos"),jQuery(t.item).index());jQuery(t.item).attr("data-order",s),jQuery(".course-section").each(function(e){jQuery(this).attr("id",e+1),jQuery(this).find("label").text("Section "+(e+1)+":"),jQuery(this).find("a.add-lesson").attr("data-section",e+1)}),order_lessons(),update_syllabus()}})},get_sections=function(){var e=[],t=0;return jQuery("#syllabus .section-select").each(function(){t++;var s={},a=jQuery(this).val();s.section_id=jQuery(this).val(),s.position=t;var n=jQuery(this).parent().parent().attr("id");jQuery("#"+n).find("a").attr("data-section_id",a),jQuery("#"+n).find("tr").attr("data-section_id",a),s.lessons=parse_lessons(a),e.push(s)}),e},parse_lessons=function(e){var e=e,t=[];return jQuery(".course-section tbody select").each(function(){var s=jQuery(this).parent().parent().parent().parent().parent().attr("id"),a=(jQuery("#"+s+" .list_item").length+1,{});a.lesson_id=jQuery(this).val();var n=jQuery(this).parent().parent().attr("data-order");n=n.substr(n.lastIndexOf("_")+1),a.position=n,jQuery(this).parent().parent().attr("data-section_id")==e&&t.push(a)}),t},update_syllabus=function(){console.log("update syllabus called");var e=get_sections(),t={action:"update_syllabus",post_id:jQuery("#syllabus").data("post_id"),sections:e},s=new Ajax("post",t,(!1));s.update_syllabus()},get_associated_lessons=function(e,t){console.log("get_associated_lessons called");var s=new Ajax("post",{action:"get_associated_lessons",section_id:e,section_position:t},(!0));s.get_associated_lessons(e,t)},add_associated_lessons=function(e,t,s){console.log("add_associated_lessons triggered"),console.log(e),console.log(t),console.log(s),associated_lesson_template(e,t,s)},get_lessons=function(e,t){var s=new Ajax("post",{action:"get_lessons"},(!0));s.get_lessons(e,t)},add_new_lesson=function(e){var t=jQuery(e.target).attr("data-section_id");if(void 0===typeof jQuery(e.target).attr("data-section"))var s=1;else var s=jQuery(e.target).attr("data-section");get_lessons(t,s)},lesson_template=function(e,t,s){var a=jQuery("#"+s+" .list_item").length+1,n="list_item_"+s+"_"+a,o="row_"+s+"_"+a;jQuery("#"+s+" .dad-list").length;jQuery('<tr class="list_item" id="'+o+'" data-section_id="'+t+'" data-order="'+a+'"> \t\t<td><select data-type="lesson" id="'+n+'" data-placeholder="Choose a Section" class="chosen-select lesson-select" \t\t></select></td><td><i class="fa fa-bars llms-fa-move-lesson"></i><i data-code="f153" class="dashicons dashicons-dismiss deleteBtn"></i></td></tr>').appendTo("#"+s+" .dad-list tbody").hide().fadeIn(300),jQuery(l).change(function(){update_syllabus(jQuery(l).val())}),jQuery("#"+s+" .dad-list tbody .lesson-select").change(function(){get_edit_link(jQuery(this)),update_syllabus(),jQuery(this).attr("disabled","disabled")}),jQuery(".deleteBtn").click(function(){jQuery(this).attr("class");jQuery(this).parent().parent().remove(),order_lessons(),update_syllabus()});for(var i in e)if(e.hasOwnProperty(i)){var l=jQuery("#"+s+" #"+n),r='<option value="'+e[i].ID+'">'+e[i].post_title+"</option>";jQuery(l).append(r)}jQuery(l).prepend('<option value="" selected disabled>Please select a lesson...</option>')},get_edit_link=function(e){console.log("get edit link called"),console.log(e);var t=jQuery(e).val(),s=jQuery(e).attr("id");console.log("element_id"),console.log(s);var a=jQuery(e).attr("data-type");console.log(t);var n=new Ajax("post",{action:"get_lesson",lesson_id:t},(!0));n.get_lesson(t,s,a)},add_edit_link=function(e,t,s,a){console.log("add_edit_link called"),console.log(t),console.log(e),console.log(s),console.log("type"),console.log(a);var n=document.createElement("a");n.setAttribute("href",encodeURI(e.edit_url));var o=document.createElement("i");o.setAttribute("class","fa fa-pencil-square-o llms-fa-edit-lesson"),n.appendChild(o),"lesson"==a&&jQuery("#"+s).parent().next().append(n),"section"==a&&(console.log("trying to append the emelemnt"),jQuery("#"+s).parent().append(n))},associated_lesson_template=function(e,t,s){for(var a in e){var n=jQuery("#"+s+" .list_item").length+1,o="list_item_"+s+"_"+n,i="row_"+s+"_"+n;jQuery("#"+s+" .dad-list").length;if(jQuery('<tr class="list_item" id="'+i+'" data-section_id="'+t+'" data-order="'+n+'"> \t\t\t<td><select id="'+o+'" data-placeholder="Choose a Section" class="chosen-select lesson-select" disabled="disabled" \t\t\t></select></td><td><a href="'+e[a].edit_url+'"><i class="fa fa-pencil-square-o llms-fa-edit-lesson"></i></a> \t\t\t<i class="fa fa-bars llms-fa-move-lesson"></i><i data-code="f153" class="dashicons dashicons-dismiss deleteBtn"></i></td></tr>').appendTo("#"+s+" .dad-list tbody").hide().fadeIn(300),jQuery(l).change(function(){update_syllabus(jQuery(l).val())}),jQuery("#"+s+" .dad-list tbody .lesson-select").change(function(){get_edit_link(jQuery(this)),update_syllabus(),jQuery(this).attr("disabled","disbaled")}),jQuery(".deleteBtn").click(function(){jQuery(this).attr("class");jQuery(this).parent().parent().remove(),order_lessons(),update_syllabus()}),e.hasOwnProperty(a)){var l=jQuery("#"+s+" #"+o),r='<option selected value="'+e[a].ID+'">'+e[a].post_title+"</option>";jQuery(l).append(r)}}},delete_this=function(e){jQuery(e).parent().parent().remove(),jQuery(".course-section").each(function(e){jQuery(this).attr("id",e+1),jQuery(this).find("label").text("Section "+(e+1)+":"),jQuery(this).find("a.add-lesson").attr("data-section",e+1)}),order_lessons(),update_syllabus()},function(e){add_new_section=function(){var e=new Ajax("post",{action:"get_sections"},(!1));e.get_sections()},section_template=function(t){var s=t,a=e(".course-section").length+1,n="section_"+a,o=document.createElement("div");o.setAttribute("class","course-section"),o.setAttribute("id",a);var i=document.createElement("p");i.setAttribute("class","title");var l=document.createElement("label");l.setAttribute("class","order"),e(l).text("Section "+a+":");var r=document.createElement("select");r.setAttribute("class","chosen-select chosen select section-select"),r.setAttribute("data-placeholder","Select a Section"),r.setAttribute("data-type","section"),r.setAttribute("id","section_item_"+a),e(r).click(function(){reverse_selection(e(r))}),e(r).change(function(){get_edit_link(jQuery(this)),catch_duplicates(e(r)),e(this).attr("disabled","disbaled")}),e(r).attr("selectedIndex",-1);var c=document.createElement("i");c.setAttribute("data-code","f153"),c.setAttribute("class","dashicons dashicons-dismiss section-dismiss"),e(c).click(function(){delete_this(e(r))});var d=document.createElement("i");d.setAttribute("class","fa fa-bars llms-fa-move-lesson");var u=document.createElement("a");u.setAttribute("class","button button-primary add-lesson"),e("#"+n).data("section",{ID:a}),e(u).attr("data-section",a),e(u).text("Add Lesson"),e(u).on("click",function(e){add_new_lesson(e)});var _='<table class="wp-list-table widefat fixed posts dad-list"> \t\t<thead><tr><th>Name</th><th></th></tr></thead> \t\t<tfoot><tr><th>Name</th><th></th></tr> \t\t</tfoot><tbody></tbody></table>';e(r).append('<option value="" selected disabled>Please select a section...</option>');for(var h in s)if(s.hasOwnProperty(h)){var p=e("<option />").val(s[h].ID).text(s[h].post_title);e(r).append(p)}i.appendChild(l),i.appendChild(r),i.appendChild(c),i.appendChild(d),o.appendChild(i),e(o).append(_),e(o).append(u),e("#syllabus").hide().append(o).fadeIn(1e3),e(r).trigger("chosen:updated"),lessons_sortable()}}(jQuery);