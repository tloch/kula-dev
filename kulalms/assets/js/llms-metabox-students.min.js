!function(t,e){window.llms=window.llms||{};var s=function(){this.init=function(){var e=["course","llms_membership"];window.llms.post.post_type&&-1!==e.indexOf(window.llms.post.post_type)&&(this.$metabox=t("#lifterlms-students"),this.bind())},this.bind=function(){var e=this;this.$metabox.on("click","a.llms-remove-student",function(){e.remove_student(t(this))}),this.$metabox.on("click","a.llms-add-student",function(){e.add_student(t(this))}),t("#llms-add-student-select").llmsStudentsSelect2({multiple:!0}),t("#llms-enroll-students").on("click",function(){e.enroll_students(t(this))})},this.add_student=function(t){this.update_student_enrollment(t.attr("data-id"),"add")},this.enroll_students=function(e){var s=this,n=e.attr("data-page"),l=t("#llms-add-student-select"),a=l.val(),d=this.$metabox.find(".llms-metabox-students-add-new");LLMS.Spinner.start(d),window.LLMS.Ajax.call({data:{action:"bulk_enroll_students",page:n,student_ids:a},beforeSend:function(t){s.$metabox.find(".llms-error").remove(),a||(e.before('<span class="llms-error">'+LLMS.l10n.translate("Please select a student to enroll")+"</span>"),t.abort(),LLMS.Spinner.stop(d))},success:function(s){s.success&&s.data?(t("#llms-students-table").replaceWith(s.data),l.val("").trigger("change")):e.before('<span class="llms-error">'+s.message+"</span>"),LLMS.Spinner.stop(d)}})},this.remove_student=function(t){this.update_student_enrollment(t.attr("data-id"),"remove")},this.update_student_enrollment=function(e,s){var n=this,l=this.$metabox.find(".llms-metabox-students-enrollments");LLMS.Spinner.start(l),window.LLMS.Ajax.call({data:{action:"update_student_enrollment",status:s,student_id:e},beforeSend:function(){n.$metabox.find("p.error").remove()},success:function(s){s.success&&s.data?t("#llms-student-id-"+e).replaceWith(s.data):n.$metabox.find(".llms-metabox-students-enrollments").prepend('<p class="error">'+s.message+"</p>"),LLMS.Spinner.stop(l)}})},this.init()};window.llms.MetaboxStudents=new s}(jQuery);